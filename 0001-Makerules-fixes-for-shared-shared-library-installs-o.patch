From 3df9a9b2194fc075d7d3c798b379020b98081f95 Mon Sep 17 00:00:00 2001
Message-ID: <3df9a9b2194fc075d7d3c798b379020b98081f95.1706899657.git.mjg@fedoraproject.org>
From: Julian Smith <julian.smith@artifex.com>
Date: Thu, 14 Sep 2023 18:57:42 +0100
Subject: [PATCH 1/2] Makerules: fixes for shared shared library installs on
 OpenBSD.

We need to use the same pkg-config calls as Linux.

(cherry picked from commit fbf12be21348aa2ea8977a61d1dac1fcf04c36ed)
---
 Makerules | 18 +++++++++++++++---
 1 file changed, 15 insertions(+), 3 deletions(-)

diff --git a/Makerules b/Makerules
index f25a8ce0b..8b2254c4e 100644
--- a/Makerules
+++ b/Makerules
@@ -154,6 +154,13 @@ ifneq "$(CLUSTER)" ""
   CFLAGS += -DCLUSTER
 endif
 
+ifeq ($(OS),Linux)
+    LINUX_OR_OPENBSD := yes
+endif
+ifeq ($(OS),OpenBSD)
+    LINUX_OR_OPENBSD := yes
+endif
+
 ifeq ($(OS),MINGW)
   WINDRES := windres
   HAVE_WIN32 := yes
@@ -180,7 +187,7 @@ else ifeq ($(OS),MACOS)
     endif
   endif
 
-else ifeq ($(OS),Linux)
+else ifeq ($(LINUX_OR_OPENBSD),yes)
   ifeq ($(PYODIDE_ROOT),)
     HAVE_OBJCOPY := yes
   else
@@ -239,8 +246,13 @@ else ifeq ($(OS),Linux)
 
   HAVE_GLUT := yes
   ifeq ($(HAVE_GLUT),yes)
-	SYS_GLUT_CFLAGS :=
-	SYS_GLUT_LIBS := -lglut -lGL
+    ifeq ($(OS),OpenBSD)
+      SYS_GLUT_CFLAGS := $(shell pkg-config --cflags glut gl)
+      SYS_GLUT_LIBS := $(shell pkg-config --libs glut gl)
+    else
+      SYS_GLUT_CFLAGS :=
+      SYS_GLUT_LIBS := -lglut -lGL
+    endif
   endif
 
   HAVE_X11 := $(shell pkg-config --exists x11 xext && echo yes)
-- 
2.43.0.692.g719022bfa2

